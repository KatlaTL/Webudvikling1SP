<div class="container">
    <div class="row">
        <div class="col-md-8 mb-3">
            <div class="box box-left border card text-white mb-3">
                <div class="card-header">Feature requests</div>
                <div class="card-body bg-white">

                    <h4 class="card card-header">New feature request</h2>
                        <!-- action="/featureRequests/create" method="post" -->
                        <form id="createForm">
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select class="form-control" id="category" name="category">
                                    <option value="" disabled selected>Select a Category</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="title">Title</label>
                                <input type="text" class="form-control" id="title" name="title"
                                    placeholder="Short descriptive title">
                            </div>

                            <div class="form-group">
                                <label for="details">Details</label>
                                <textarea class="form-control" id="details" name="details"
                                    placeholder="Any additional details..."></textarea>
                            </div>

                            <button id="btngreen" type="submit" class="btn">Submit</button>
                        </form>
                </div>
            </div>
        </div>
        <!-- Including the roadmap -->
        <%- include("../partials/roadmap.ejs") %>
    </div>
</div>

<script>
    fetchWrapper.get("categories")
        .then(data => {
            const selectList = document.querySelector(".form-control");
            for (let i = 0; i < data.categories.length; i++) {
                const category = data.categories[i].category; 
                const option = document.createElement("option");
                const textNode = document.createTextNode(category);

                option.appendChild(textNode);
                option.setAttribute("value", category);
                option.setAttribute("data-id", data.categories[i].id)
                selectList.appendChild(option);
            }
        })
        .catch(err => console.error(err));    
    
    const form = document.querySelector("#createForm");
    form.addEventListener("submit", (e) => {
        e.preventDefault();
        const { category, title, details} = e.target;

        fetchWrapper.post("/featureRequests/create", {
            headers: {
                "Authorization": `Bearer ${JSON.parse(localStorage.getItem("user")).authorization}`
            },
            body: {
                category: { 
                    id: category.options[category.selectedIndex].dataset.id,
                    category: category.value
                },
                title: title.value,
                details: details.value
            }
        })
        .then(data =>  window.location.href = new URL(document.baseURI).origin)
        .catch(err => console.error(err));
    });
</script>